import { ChartData, ScatterDataPoint } from "chart.js";
import React from "react";
import { LineCharts } from "../Charts";
import moment from "moment";
import { useSelector } from "react-redux";
import { StoreApp } from "@/redux";
import _ from "lodash";
import { IMail } from "../../interfaces/IMail";

export const MailsChart = () => {
  ///Metodo que devuelve una lista con todos los dias del mes en formato de fecha
  const getDaysInMonth = (month: number, year: number): Date[] =>
    new Array(31)
      .fill("")
      .map((v, i) => new Date(year, month - 1, i + 1))
      .filter((v) => v.getMonth() === month - 1);

  const dateNow = new Date(Date.now());

  const days = getDaysInMonth(dateNow.getMonth(), dateNow.getFullYear());

  const { mails } = useSelector((state: StoreApp) => state.mails);

  const mailsForDay = _.chain(mails)
    .groupBy((a) => a.Fecha)
    .toPairs()
    .map((pair) => _.zipObject(["ID", "mails"], pair))
    .value();

  console.log({ mailsForDay });

  const data: ChartData<"line", (number | ScatterDataPoint | null)[], unknown> =
    {
      labels: [...days.map((day) => moment(day).format("YY/MM/DD"))],
      datasets: [
        {
          data: [
            ...days.map((day, i) => {
              let dataObj = mailsForDay.find((e) => {
                var dataDay = moment(e.ID as any).date();

                console.log({ dataDay });
                if (day.getDate() === dataDay) {
                  return e;
                }
              });
              if (!!dataObj) {
                return (dataObj.mails as IMail[]).length;
              }
              return 0;
            }),
          ],

          borderColor: "rgb(75, 192, 192)",
          tension: 0.1,
          // borderColor: "#2188e4",
          backgroundColor: "rgba(75, 192, 192,0.5)",
          fill: true,
          label: "Mails",
          //  // Configuracion Puntos
          pointRadius: 5,
          pointStyle: "circle",
          //  pointBorderColor: "#fff",
          // pointBackgroundColor: "rgba(75, 192, 192,0.5)",
          //  // pointHoverBorderColor: "rgba(220,220,220,1)",

          //  // Configuracion Linea
          //  backgroundColor: "#2188e4", // Color etiqueta
          //  borderColor: "#2188e4", //Color Border Etiqueta

          //  borderCapStyle: "butt",
          //  borderWidth: 2,

          //  borderJoinStyle: "miter",
          //  pointBorderWidth: 0,
          //  pointHoverRadius: 0,
          //  fill: true,

          //  tension: 0.1,
        },
      ],
    };

  return <LineCharts data={data} title="Mails AÃ±o" />;
};
